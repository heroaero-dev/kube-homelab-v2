apiVersion: helmfile.v1
kind: Helmfile

hooks:
  - events: ["prepare"]
    command: "bash"
    args:
      - "-c"
      - |
          echo "Waiting for Kubernetes API to be ready..."
          until kubectl get namespace kube-system >/dev/null 2>&1; do
            echo "Kubernetes API not ready yet, waiting..."
            sleep 3
          done
          echo "Kubernetes API ready!"

releases:
  - name: cilium-crds
    namespace: kube-system
    chart: cilium/cilium
    version: 1.16.3
    disableHooks: true
    wait: true
    force: true
    values:
      - {}
    crds: Create

